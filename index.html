<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒã‚¤ãƒˆåæ”¯ï¼†æ‰¶é¤Šãƒã‚§ãƒƒã‚«ãƒ¼</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: #f9f9f9;
      padding: 2em;
    }
    form, .summary, .chart-box, .controls {
      background: #fff;
      padding: 20px;
      margin-bottom: 2em;
      border-radius: 8px;
      box-shadow: 0 0 5px #ccc;
      max-width: 700px;
    }
    h1, h2 {
      color: #333;
    }
    label {
      display: block;
      margin-top: 1em;
      font-weight: bold;
    }
    input {
      width: 100%;
      padding: 0.5em;
      margin-top: 0.3em;
    }
    button {
      margin-top: 1.5em;
      padding: 10px 20px;
      background: #4caf50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #388e3c;
    }
    canvas {
      width: 100%;
    }
  </style>
</head>
<body>

<h1>ğŸ—“ï¸ ãƒã‚¤ãƒˆåæ”¯ï¼†æ‰¶é¤Šãƒã‚§ãƒƒã‚«ãƒ¼</h1>

<form id="workForm">
  <label>é–‹å§‹æ—¥ <input type="date" id="startDate"></label>
  <label>é–‹å§‹æ™‚åˆ» <input type="time" id="startTime" step="300"></label>
  <label>çµ‚äº†æ—¥ <input type="date" id="endDate"></label>
  <label>çµ‚äº†æ™‚åˆ» <input type="time" id="endTime" step="300"></label>
  <label>ä¼‘æ†©æ™‚é–“ï¼ˆåˆ†ï¼‰<input type="number" id="breakTime" value="0" step="5"></label>
  <label>æ™‚çµ¦ï¼ˆå††ï¼‰<input type="number" id="wage" value="1000"></label>
  <label>äº¤é€šè²»ï¼ˆå††ï¼‰<input type="number" id="transport" value="0"></label>
  <button type="submit">è¨˜éŒ²ã™ã‚‹</button>
</form>

<div class="summary">
  <h2>ğŸ“Š ç´¯è¨ˆæƒ…å ±</h2>
  <p id="totalHours">ç·å‹¤å‹™æ™‚é–“: 0 æ™‚é–“</p>
  <p id="totalIncome">ç·åå…¥: Â¥0</p>
  <p id="fuyouCheck">æ‰¶é¤Šå†…: â—‹</p>
</div>

<div class="chart-box">
  <h2>ğŸ“ˆ å‹¤å‹™å±¥æ­´ã‚°ãƒ©ãƒ•</h2>
  <canvas id="workChart"></canvas>
</div>

<div class="controls">
  <button onclick="clearLast()">æœ€å¾Œã®è¨˜éŒ²ã‚’å‰Šé™¤</button>
  <button onclick="clearAll()">ã™ã¹ã¦å‰Šé™¤</button>
</div>

<script>
  const form = document.getElementById("workForm");
  const totalHoursElem = document.getElementById("totalHours");
  const totalIncomeElem = document.getElementById("totalIncome");
  const fuyouElem = document.getElementById("fuyouCheck");
  const fuyouLimit = 103000;

  let records = JSON.parse(localStorage.getItem("workRecords")) || [];
  let chart;

  form.addEventListener("submit", function (e) {
    e.preventDefault();
    const sDate = new Date(`${startDate.value}T${startTime.value}`);
    const eDate = new Date(`${endDate.value}T${endTime.value}`);
    const breakMin = parseFloat(breakTime.value);
    const wage = parseFloat(document.getElementById("wage").value);
    const transport = parseFloat(document.getElementById("transport").value);
    const workTime = (eDate - sDate) / (1000 * 60 * 60) - breakMin / 60;
    const income = Math.round(workTime * wage + transport);
    const dateLabel = startDate.value;
    records.push({ label: dateLabel, hours: workTime, income: income });
    localStorage.setItem("workRecords", JSON.stringify(records));
    updateSummary();
    updateChart();
    form.reset();
  });

  function updateSummary() {
    const totalHours = records.reduce((acc, rec) => acc + rec.hours, 0);
    const totalIncome = records.reduce((acc, rec) => acc + rec.income, 0);
    totalHoursElem.textContent = `ç·å‹¤å‹™æ™‚é–“: ${totalHours.toFixed(2)} æ™‚é–“`;
    totalIncomeElem.textContent = `ç·åå…¥: Â¥${totalIncome}`;
    fuyouElem.textContent = `æ‰¶é¤Šå†…: ${totalIncome <= fuyouLimit ? "â—‹" : "Ã—"}`;
  }

  function updateChart() {
    const ctx = document.getElementById("workChart").getContext("2d");
    const labels = records.map(r => r.label);
    const hoursData = records.map(r => r.hours);
    const incomeData = records.map(r => r.income);
    if (chart) chart.destroy();
    chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [
          {
            label: 'å‹¤å‹™æ™‚é–“ (æ™‚é–“)',
            data: hoursData,
            backgroundColor: 'rgba(33, 150, 243, 0.5)'
          },
          {
            label: 'åå…¥ (å††)',
            data: incomeData,
            backgroundColor: 'rgba(76, 175, 80, 0.5)'
          }
        ]
      },
      options: {
        responsive: true,
        scales: { y: { beginAtZero: true } }
      }
    });
  }

  function clearLast() {
    records.pop();
    localStorage.setItem("workRecords", JSON.stringify(records));
    updateSummary();
    updateChart();
  }

  function clearAll() {
    if (confirm("ã™ã¹ã¦ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
      records = [];
      localStorage.removeItem("workRecords");
      updateSummary();
      updateChart();
    }
  }

  updateSummary();
  updateChart();
</script>

</body>
</html>
